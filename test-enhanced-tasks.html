<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Enhanced Tasks - TaskFlow</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        .progress-section {
            background: #f8fafc;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 2px solid #e5e7eb;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e5e7eb;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4ade80 0%, #22c55e 100%);
            width: 0%;
            transition: width 0.8s ease;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: #f8fafc;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid #e5e7eb;
        }
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #4f46e5;
        }
        .stat-label {
            color: #6b7280;
            font-size: 0.9rem;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #374151;
        }
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #4f46e5;
        }
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        button {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            width: 100%;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3);
        }
        .task-item {
            background: #f8fafc;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        .task-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .task-item.completed {
            opacity: 0.7;
            background: #f0fdf4;
            border-color: #bbf7d0;
        }
        .task-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }
        .task-checkbox {
            width: 20px;
            height: 20px;
            accent-color: #4f46e5;
        }
        .task-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #1f2937;
            margin: 0;
        }
        .task-meta {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }
        .task-category, .task-priority {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        .task-category {
            background: #e0e7ff;
            color: #3730a3;
        }
        .task-priority.high {
            background: #fee2e2;
            color: #dc2626;
        }
        .task-priority.medium {
            background: #fef3c7;
            color: #d97706;
        }
        .task-priority.low {
            background: #d1fae5;
            color: #059669;
        }
        .task-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .task-action-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: bold;
        }
        .task-action-btn.edit {
            background: #dbeafe;
            color: #2563eb;
        }
        .task-action-btn.delete {
            background: #fee2e2;
            color: #dc2626;
        }
        .message {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            font-weight: bold;
        }
        .message.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }
        .message.error {
            background: #fee2e2;
            color: #dc2626;
            border: 1px solid #ef4444;
        }
        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .filter-btn {
            padding: 8px 16px;
            border: 2px solid #e5e7eb;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        .filter-btn.active {
            background: #4f46e5;
            color: white;
            border-color: #4f46e5;
        }
        .filter-btn:hover {
            border-color: #4f46e5;
            color: #4f46e5;
        }
        .filter-btn.active:hover {
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ§ª Test Enhanced Tasks</h1>
        
        <!-- Progress Section -->
        <div class="progress-section">
            <h3>Progress</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <div style="text-align: center; margin-top: 10px;">
                <span id="progress-text">0% Complete</span>
            </div>
        </div>
        
        <!-- Statistics -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="total-tasks">0</div>
                <div class="stat-label">Total Tasks</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="completed-tasks">0</div>
                <div class="stat-label">Completed</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="pending-tasks">0</div>
                <div class="stat-label">Pending</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="urgent-tasks">0</div>
                <div class="stat-label">Urgent</div>
            </div>
        </div>
        
        <!-- Task Form -->
        <form id="task-form">
            <div class="form-row">
                <div class="form-group">
                    <label for="title">Task Title *</label>
                    <input type="text" id="title" name="title" required>
                </div>
                <div class="form-group">
                    <label for="category">Category</label>
                    <select id="category" name="category">
                        <option value="general">General</option>
                        <option value="work">Work</option>
                        <option value="personal">Personal</option>
                        <option value="shopping">Shopping</option>
                        <option value="health">Health</option>
                        <option value="learning">Learning</option>
                    </select>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="priority">Priority</label>
                    <select id="priority" name="priority">
                        <option value="low">Low</option>
                        <option value="medium" selected>Medium</option>
                        <option value="high">High</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="due_date">Due Date</label>
                    <input type="datetime-local" id="due_date" name="due_date">
                </div>
            </div>
            
            <div class="form-group">
                <label for="description">Description</label>
                <textarea id="description" name="description" rows="3"></textarea>
            </div>
            
            <div class="form-group">
                <label for="tags">Tags (comma separated)</label>
                <input type="text" id="tags" name="tags" placeholder="urgent, important, meeting">
            </div>
            
            <button type="submit">Add Task</button>
        </form>
        
        <!-- Filters -->
        <div class="filters">
            <button class="filter-btn active" data-filter="all">All</button>
            <button class="filter-btn" data-filter="pending">Pending</button>
            <button class="filter-btn" data-filter="completed">Completed</button>
            <button class="filter-btn" data-filter="high">High Priority</button>
        </div>
        
        <!-- Tasks List -->
        <div id="tasks-list">
            <!-- Tasks will be loaded here -->
        </div>
        
        <!-- Messages -->
        <div id="message-container"></div>
    </div>

    <script>
        class TestTaskManager {
            constructor() {
                this.tasks = [];
                this.currentFilter = 'all';
                this.init();
            }
            
            init() {
                this.setupEventListeners();
                this.loadTasks();
            }
            
            setupEventListeners() {
                document.getElementById('task-form').addEventListener('submit', (e) => this.handleAddTask(e));
                
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => this.setFilter(e.target.dataset.filter));
                });
            }
            
            async loadTasks() {
                try {
                    const response = await fetch('php/tasks-api.php');
                    const result = await response.json();
                    
                    if (result.success) {
                        this.tasks = result.tasks || [];
                        this.renderTasks();
                        this.updateStatistics();
                    } else {
                        this.showMessage('Failed to load tasks: ' + result.message, 'error');
                    }
                } catch (error) {
                    console.error('Error loading tasks:', error);
                    this.showMessage('Failed to load tasks', 'error');
                }
            }
            
            async handleAddTask(e) {
                e.preventDefault();
                
                const formData = new FormData(e.target);
                const taskData = {
                    action: 'add',
                    title: formData.get('title'),
                    description: formData.get('description'),
                    priority: formData.get('priority'),
                    category: formData.get('category'),
                    due_date: formData.get('due_date'),
                    tags: formData.get('tags') ? formData.get('tags').split(',').map(tag => tag.trim()) : []
                };
                
                try {
                    const response = await fetch('php/tasks-api.php', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(taskData)
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        this.tasks.unshift(result.task);
                        this.renderTasks();
                        this.updateStatistics();
                        e.target.reset();
                        this.showMessage('Task added successfully!', 'success');
                    } else {
                        this.showMessage('Failed to add task: ' + result.message, 'error');
                    }
                } catch (error) {
                    console.error('Error adding task:', error);
                    this.showMessage('Failed to add task', 'error');
                }
            }
            
            async toggleTask(taskId) {
                try {
                    const response = await fetch('php/tasks-api.php', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            action: 'toggle',
                            id: taskId
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        const task = this.tasks.find(t => t.id == taskId);
                        if (task) {
                            task.done = !task.done;
                            task.completed_at = task.done ? new Date().toISOString() : null;
                        }
                        this.renderTasks();
                        this.updateStatistics();
                    } else {
                        this.showMessage('Failed to toggle task: ' + result.message, 'error');
                    }
                } catch (error) {
                    console.error('Error toggling task:', error);
                    this.showMessage('Failed to toggle task', 'error');
                }
            }
            
            async deleteTask(taskId) {
                if (!confirm('Are you sure you want to delete this task?')) {
                    return;
                }
                
                try {
                    const response = await fetch('php/tasks-api.php', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            action: 'delete',
                            id: taskId
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        this.tasks = this.tasks.filter(t => t.id != taskId);
                        this.renderTasks();
                        this.updateStatistics();
                        this.showMessage('Task deleted successfully!', 'success');
                    } else {
                        this.showMessage('Failed to delete task: ' + result.message, 'error');
                    }
                } catch (error) {
                    console.error('Error deleting task:', error);
                    this.showMessage('Failed to delete task', 'error');
                }
            }
            
            renderTasks() {
                const tasksList = document.getElementById('tasks-list');
                const filteredTasks = this.getFilteredTasks();
                
                if (filteredTasks.length === 0) {
                    tasksList.innerHTML = '<div style="text-align: center; padding: 40px; color: #6b7280;">No tasks found</div>';
                    return;
                }
                
                tasksList.innerHTML = filteredTasks.map(task => this.createTaskHTML(task)).join('');
            }
            
            createTaskHTML(task) {
                const isOverdue = task.due_date && new Date(task.due_date) < new Date() && !task.done;
                const dueDate = task.due_date ? new Date(task.due_date).toLocaleDateString() : null;
                
                return `
                    <div class="task-item ${task.done ? 'completed' : ''}">
                        <div class="task-header">
                            <input type="checkbox" 
                                   class="task-checkbox" 
                                   ${task.done ? 'checked' : ''} 
                                   onchange="taskManager.toggleTask(${task.id})">
                            <h3 class="task-title">${this.escapeHtml(task.title)}</h3>
                        </div>
                        ${task.description ? `<p style="color: #6b7280; margin: 10px 0;">${this.escapeHtml(task.description)}</p>` : ''}
                        <div class="task-meta">
                            <span class="task-category">${this.escapeHtml(task.category)}</span>
                            <span class="task-priority ${task.priority}">${task.priority.charAt(0).toUpperCase() + task.priority.slice(1)}</span>
                            ${dueDate ? `<span style="background: #f3f4f6; color: #374151; padding: 4px 8px; border-radius: 6px; font-size: 0.8rem; ${isOverdue ? 'background: #fee2e2; color: #dc2626;' : ''}">Due: ${dueDate}</span>` : ''}
                        </div>
                        ${task.tags && task.tags.length > 0 ? `
                            <div style="margin: 10px 0;">
                                ${task.tags.map(tag => `<span style="background: #e5e7eb; color: #374151; padding: 2px 6px; border-radius: 4px; font-size: 0.75rem; margin-right: 4px;">#${this.escapeHtml(tag)}</span>`).join('')}
                            </div>
                        ` : ''}
                        <div class="task-actions">
                            <button class="task-action-btn edit" onclick="alert('Edit functionality would be here')">Edit</button>
                            <button class="task-action-btn delete" onclick="taskManager.deleteTask(${task.id})">Delete</button>
                        </div>
                    </div>
                `;
            }
            
            getFilteredTasks() {
                switch (this.currentFilter) {
                    case 'pending':
                        return this.tasks.filter(task => !task.done);
                    case 'completed':
                        return this.tasks.filter(task => task.done);
                    case 'high':
                        return this.tasks.filter(task => task.priority === 'high');
                    default:
                        return this.tasks;
                }
            }
            
            setFilter(filter) {
                this.currentFilter = filter;
                
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`[data-filter="${filter}"]`).classList.add('active');
                
                this.renderTasks();
            }
            
            updateStatistics() {
                const totalTasks = this.tasks.length;
                const completedTasks = this.tasks.filter(task => task.done).length;
                const pendingTasks = totalTasks - completedTasks;
                const urgentTasks = this.tasks.filter(task => task.priority === 'high' && !task.done).length;
                
                document.getElementById('total-tasks').textContent = totalTasks;
                document.getElementById('completed-tasks').textContent = completedTasks;
                document.getElementById('pending-tasks').textContent = pendingTasks;
                document.getElementById('urgent-tasks').textContent = urgentTasks;
                
                // Update progress
                const percentage = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
                document.getElementById('progress-fill').style.width = percentage + '%';
                document.getElementById('progress-text').textContent = percentage + '% Complete';
            }
            
            showMessage(message, type) {
                const container = document.getElementById('message-container');
                const messageEl = document.createElement('div');
                messageEl.className = `message ${type}`;
                messageEl.textContent = message;
                container.appendChild(messageEl);
                
                setTimeout(() => {
                    container.removeChild(messageEl);
                }, 3000);
            }
            
            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
        }
        
        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            window.taskManager = new TestTaskManager();
        });
    </script>
</body>
</html>
